<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Autocorrect Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header and other content remains the same -->
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // ... configuration code ...
                
                const inputText = document.getElementById('inputText');
                const outputText = document.getElementById('outputText');
                const correctBtn = document.getElementById('correctBtn');
                const copyBtn = document.getElementById('copyBtn');
                const loading = document.getElementById('loading');
                
                // Function to highlight differences between two texts
                function highlightDifferences(original, corrected) {
                    // ... existing highlightDifferences function ...
                }
                
                correctBtn.addEventListener('click', async function() {
                    const text = inputText.value.trim();
                    
                    if (!text) {
                        alert('Please enter some text to correct.');
                        return;
                    }
                    
                    // Show loading indicator
                    loading.classList.remove('hidden');
                    correctBtn.disabled = true;
                    outputText.innerHTML = ''; // Clear previous results
                    
                    try {
                        // FIXED: Use absolute URL for the API endpoint
                        const apiUrl = window.location.origin + '/correct';
                        
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify({ text: text })
                        });
                        
                        // Check if the response is OK (status 200-299)
                        if (!response.ok) {
                            throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.error) {
                            alert('Error: ' + data.error);
                        } else {
                            // Highlight differences between original and corrected text
                            const highlighted = highlightDifferences(text, data.corrected_text);
                            outputText.innerHTML = highlighted;
                        }
                    } catch (error) {
                        console.error('Fetch error:', error);
                        
                        // Provide more specific error messages
                        if (error.name === 'TypeError' && error.message.includes('fetch')) {
                            alert('Network error: Could not connect to the server. Please make sure the backend is running.');
                        } else if (error.name === 'SyntaxError') {
                            alert('Server error: Received invalid response from the server.');
                        } else {
                            alert('An error occurred: ' + error.message);
                        }
                    } finally {
                        // Hide loading indicator
                        loading.classList.add('hidden');
                        correctBtn.disabled = false;
                    }
                });
                
                // ... copy button code ...
            });
        </script>
    </div>
</body>
</html>
